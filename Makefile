SIMTOOLS_DIR        = ../osmocom-sim-tools

PACKAGE_AID         = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53
PACKAGE_NAME        = com.github.cheeriotb.cts.cardlet
PACKAGE_VERSION     = 1.63

APPLET_AID_31       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x31
APPLET_AID_32       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x32
APPLET_AID_40       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x40
APPLET_AID_41       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x41
APPLET_AID_42       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x42
APPLET_AID_43       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x43
APPLET_AID_44       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x44
APPLET_AID_45       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x45
APPLET_AID_46       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x46
APPLET_AID_47       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x47
APPLET_AID_48       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x48
APPLET_AID_49       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x49
APPLET_AID_4A       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x4A
APPLET_AID_4B       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x4B
APPLET_AID_4C       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x4C
APPLET_AID_4D       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x4D
APPLET_AID_4E       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x4E
APPLET_AID_4F       = 0xA0:0x00:0x00:0x04:0x76:0x41:0x6E:0x64:0x72:0x6F:0x69:0x64:0x43:0x54:0x53:0x4F

APPLET_NAME         = com.github.cheeriotb.cts.cardlet.OmapiApplet

SOURCES             = ./src/com/github/cheeriotb/cts/cardlet/*.java

BUILD_DIR           = ./build
BUILD_CLASSES_DIR   = $(BUILD_DIR)/classes
BUILD_JAVACARD_DIR  = $(BUILD_DIR)/javacard
JAVACARD_SDK_DIR    ?= $(SIMTOOLS_DIR)/javacard
JAVACARD_EXPORT_DIR ?= $(JAVACARD_SDK_DIR)/api21_export_files

ifdef COMSPEC
CLASSPATH           = $(JAVACARD_SDK_DIR)/lib/api21.jar;$(JAVACARD_SDK_DIR)/lib/sim.jar
else
CLASSPATH           = $(JAVACARD_SDK_DIR)/lib/api21.jar:$(JAVACARD_SDK_DIR)/lib/sim.jar
endif

JFLAGS              = -target 1.1 -source 1.3 -J-Duser.language=en -g -d $(BUILD_CLASSES_DIR) -classpath "$(CLASSPATH)"
JAVA                ?= java
JC                  ?= javac

.SUFFIXES: .java .class
.java.class:
	mkdir -p $(BUILD_CLASSES_DIR)
	mkdir -p $(BUILD_JAVACARD_DIR)

	$(JC) $(JFLAGS) $*.java

	$(JAVA) -jar $(JAVACARD_SDK_DIR)/bin/converter.jar    \
		-d $(BUILD_JAVACARD_DIR)                          \
		-classdir $(BUILD_CLASSES_DIR)                    \
		-exportpath $(JAVACARD_EXPORT_DIR)                \
		-applet $(APPLET_AID_31) $(APPLET_NAME)           \
		-applet $(APPLET_AID_32) $(APPLET_NAME)           \
		-applet $(APPLET_AID_40) $(APPLET_NAME)           \
		-applet $(APPLET_AID_41) $(APPLET_NAME)           \
		-applet $(APPLET_AID_42) $(APPLET_NAME)           \
		-applet $(APPLET_AID_43) $(APPLET_NAME)           \
		-applet $(APPLET_AID_44) $(APPLET_NAME)           \
		-applet $(APPLET_AID_45) $(APPLET_NAME)           \
		-applet $(APPLET_AID_46) $(APPLET_NAME)           \
		-applet $(APPLET_AID_47) $(APPLET_NAME)           \
		-applet $(APPLET_AID_48) $(APPLET_NAME)           \
		-applet $(APPLET_AID_49) $(APPLET_NAME)           \
		-applet $(APPLET_AID_4A) $(APPLET_NAME)           \
		-applet $(APPLET_AID_4B) $(APPLET_NAME)           \
		-applet $(APPLET_AID_4C) $(APPLET_NAME)           \
		-applet $(APPLET_AID_4D) $(APPLET_NAME)           \
		-applet $(APPLET_AID_4E) $(APPLET_NAME)           \
		-applet $(APPLET_AID_4F) $(APPLET_NAME)           \
		$(PACKAGE_NAME) $(PACKAGE_AID) $(PACKAGE_VERSION)

default: classes

classes: $(SOURCES:.java=.class)

clean:
	$(RM) -rf $(BUILD_DIR)
